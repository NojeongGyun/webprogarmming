<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>íƒ€ì´í•‘ ì†ë„ ê²Œì„</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .game-container {
            background: white;
            border-radius: 20px;
            padding: 40px;
            max-width: 700px;
            width: 100%;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            animation: slideIn 0.5s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }

        .game-header h2 {
            font-size: 2rem;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            font-weight: 500;
            text-decoration: none;
            display: inline-block;
        }

        .btn-secondary {
            background: linear-gradient(135deg, #e0e0e0, #d0d0d0);
            color: #333;
        }

        .btn-secondary:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .btn-primary:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
        }

        .btn-large {
            padding: 16px 32px;
            font-size: 1.2rem;
        }

        .stats {
            display: flex;
            justify-content: space-around;
            margin-bottom: 24px;
            padding: 20px;
            background: linear-gradient(135deg, #f5f5f5, #e8e8e8);
            border-radius: 16px;
            box-shadow: inset 0 2px 10px rgba(0,0,0,0.05);
        }

        .stat-item {
            text-align: center;
        }

        .stat-label {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 4px;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .target-text {
            background: linear-gradient(135deg, #f5f5f5, #e8e8e8);
            padding: 24px;
            border-radius: 16px;
            font-size: 1.5rem;
            font-family: monospace;
            margin-bottom: 16px;
            letter-spacing: 2px;
            box-shadow: inset 0 2px 10px rgba(0,0,0,0.05);
        }

        .target-text .char-correct {
            color: #4caf50;
            font-weight: bold;
        }
        
        /* í…ìŠ¤íŠ¸ ì…ë ¥ ì¤‘ ì»¤ì„œ ìœ„ì¹˜ë¥¼ ë‚˜íƒ€ë‚´ëŠ” íš¨ê³¼ ì¶”ê°€ */
        .target-text .char-cursor {
            border-right: 2px solid #333;
            animation: blink 0.7s infinite;
        }
        @keyframes blink {
            50% { border-color: transparent; }
        }

        .target-text .char-wrong {
            color: #f44336;
            font-weight: bold;
        }

        .target-text .char-pending {
            color: #999;
        }

        .input-field {
            width: 100%;
            padding: 16px 20px;
            font-size: 1.2rem;
            border: 3px solid #e0e0e0;
            border-radius: 12px;
            margin-bottom: 16px;
            transition: all 0.3s;
        }

        .input-field:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
        }

        #start-container {
            text-align: center;
            padding: 48px;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="game-header">
            <h2>âŒ¨ï¸ íƒ€ì´í•‘ ì†ë„</h2>
            <a href="games-index.html" class="btn btn-secondary">í™ˆìœ¼ë¡œ</a>
        </div>
        <div class="game-content">
            <div class="stats">
                <div class="stat-item">
                    <div class="stat-label">ì†ë„ (WPM)</div>
                    <div class="stat-value" id="typing-wpm">0</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">ìµœê³  WPM</div>
                    <div class="stat-value" id="typing-best">-</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">ë‚¨ì€ ì‹œê°„</div>
                    <div class="stat-value" id="typing-time">60</div>
                </div>
            </div>
            <div id="start-container">
                <button class="btn btn-primary btn-large" onclick="startTyping()">ê²Œì„ ì‹œì‘</button>
            </div>
            <div id="typing-target" class="target-text" style="display: none;"></div>
            <input type="text" id="typing-input" class="input-field" placeholder="ì—¬ê¸°ì— ì…ë ¥í•˜ì„¸ìš”. ì™„ë£Œ í›„ ì—”í„°í‚¤ë¥¼ ëˆ„ë¥´ì„¸ìš”." 
                   oninput="handleTypingInput(event)" 
                   oncompositionstart="handleCompositionStart()"
                   oncompositionend="handleCompositionEnd(event)" 
                   onkeyup="handleKeyUp(event)"
                   style="display: none;">
        </div>
    </div>

    <script>
        const STORAGE_KEY = 'typingHighWPM';
        const sentences = [
            'ë¹ ë¥¸ ê°ˆìƒ‰ ì—¬ìš°ê°€ ê²Œìœ¼ë¥¸ ê°œë¥¼ ë›°ì–´ë„˜ìŠµë‹ˆë‹¤',
            'íƒ€ì´í•‘ ì†ë„ë¥¼ ì¸¡ì •í•˜ëŠ” ì¬ë¯¸ìˆëŠ” ê²Œì„ì…ë‹ˆë‹¤',
            'í”„ë¡œê·¸ë˜ë°ì€ ì°½ì˜ì ì¸ ë¬¸ì œ í•´ê²°ì…ë‹ˆë‹¤',
            'ì—°ìŠµí•˜ë©´ ì ì  ë” ë¹¨ë¼ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤',
            'í‚¤ë³´ë“œë¥¼ ë³´ì§€ ì•Šê³  íƒ€ì´í•‘í•´ë³´ì„¸ìš”'
        ];

        let targetText = '';
        let inputText = '';
        let timeLeft = 60;
        let isPlaying = false;
        let correctChars = 0;
        let timer = null;
        let isComposing = false; 

        function loadHighScore() {
            const saved = localStorage.localStorage.getItem(STORAGE_KEY);
            if (saved) {
                document.getElementById('typing-best').textContent = saved;
            }
        }

        function saveHighScore(wpm) {
            const current = localStorage.localStorage.getItem(STORAGE_KEY);
            if (!current || parseInt(wpm) > parseInt(current)) {
                localStorage.localStorage.setItem(STORAGE_KEY, wpm);
                document.getElementById('typing-best').textContent = wpm;
                return true;
            }
            return false;
        }

        function startTyping() {
            isPlaying = true;
            timeLeft = 60;
            correctChars = 0;
            isComposing = false; 
            targetText = sentences[Math.floor(Math.random() * sentences.length)].trim();
            inputText = '';
            
            document.getElementById('start-container').style.display = 'none';
            document.getElementById('typing-target').style.display = 'block';
            document.getElementById('typing-input').style.display = 'block';
            document.getElementById('typing-input').value = ''; 
            document.getElementById('typing-input').focus();
            
            updateDisplay();

            timer = setInterval(() => {
                timeLeft--;
                if (timeLeft <= 0) {
                    endTyping();
                }
                updateDisplay();
            }, 1000);
        }

        function endTyping() {
            if (!isPlaying) return;
            
            isPlaying = false;
            clearInterval(timer);
            
            const timeElapsed = 60 - timeLeft;
            const wpm = timeElapsed > 0 ? Math.round((correctChars / 5) / (timeElapsed / 60)) : 0;
            
            const score = Math.min(wpm * 2, 200); 
            const isNewRecord = saveHighScore(wpm);
            const recordText = isNewRecord ? '\nğŸ‰ ì‹ ê¸°ë¡!' : '';
            
            document.getElementById('start-container').style.display = 'block';
            document.getElementById('typing-target').style.display = 'none';
            document.getElementById('typing-input').style.display = 'none';
            
            alert(`ê²Œì„ ì¢…ë£Œ! ${wpm} WPM (${score}ì )${recordText}`);
        }

        // ë¬¸ì¥ ìƒíƒœ ë³€ê²½ ë° ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”ë¥¼ ë‹´ë‹¹í•˜ëŠ” í•µì‹¬ í•¨ìˆ˜
        function changeSentenceState() {
             const inputEl = document.getElementById('typing-input');
             
             // 1. ìƒíƒœ ì—…ë°ì´íŠ¸
             correctChars += targetText.length;
             targetText = sentences[Math.floor(Math.random() * sentences.length)].trim();
             inputText = '';
             updateDisplay();
             
             // 2. ì¤‘ìš”: ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”ë¥¼ ë‹´ë‹¹. 
             // ì¦‰ì‹œ ë¹„ìš°ê¸°
             inputEl.value = '';

             // 10ms ì§€ì—° í›„ ê°•ì œ ì¬-ë¹„ìš°ê¸° ë° í¬ì»¤ìŠ¤ (IME ì”ì—¬ ë¬¸ì œë¥¼ í™•ì‹¤íˆ í•´ê²°)
             setTimeout(() => {
                 inputEl.value = '';
                 inputEl.focus();
             }, 10);
        }

        function updateDisplay() {
            const timeElapsed = 60 - timeLeft;
            const wpm = timeElapsed > 0 ? Math.round((correctChars / 5) / (timeElapsed / 60)) : 0;
            
            document.getElementById('typing-wpm').textContent = wpm;
            document.getElementById('typing-time').textContent = timeLeft;

            let displayText = '';
            for (let i = 0; i < targetText.length; i++) {
                const char = targetText[i];
                let className = '';
                
                if (i < inputText.length) {
                    className = inputText[i] === char ? 'char-correct' : 'char-wrong';
                } else if (i === inputText.length) {
                    // í˜„ì¬ ì…ë ¥ ì¤‘ì¸ ìœ„ì¹˜ì— ì»¤ì„œ íš¨ê³¼ ì¶”ê°€
                    className = 'char-pending char-cursor';
                } else {
                    className = 'char-pending';
                }
                
                // ì»¤ì„œ ìœ„ì¹˜ì— ìˆëŠ” ê¸€ì(char)ë¥¼ spanìœ¼ë¡œ ê°ì‹¸ê³  í´ë˜ìŠ¤ ì ìš©
                displayText += `<span class="${className}">${char}</span>`;
            }
            // ì…ë ¥ í•„ë“œê°€ ë¹„ì–´ìˆê³ , ë¬¸ì¥ì´ ë‚¨ì•„ìˆì„ ê²½ìš° ë§¨ ì•ì— ì»¤ì„œ í‘œì‹œ
            if (inputText.length === 0 && targetText.length > 0) {
                 displayText = `<span class="char-pending char-cursor">${targetText[0]}</span>` + displayText.substring(displayText.indexOf('</span>') + 7);
            }
            
            document.getElementById('typing-target').innerHTML = displayText;
        }

        // IME ì…ë ¥ ì‹œì‘ ì‹œ (í•œê¸€ ì¡°í•© ì‹œì‘)
        function handleCompositionStart() {
            isComposing = true;
        }

        // IME ì…ë ¥ ì¢…ë£Œ ì‹œ (í•œê¸€ ì¡°í•© ì™„ë£Œ)
        function handleCompositionEnd(e) {
            isComposing = false;
            // ì¡°í•© ì¢…ë£Œ ì‹œ, ìë™ìœ¼ë¡œ ë‹¤ìŒ ë¬¸ì œë¡œ ë„˜ì–´ê°€ëŠ” ë¡œì§ì„ ì‚­ì œí•˜ê³  displayë§Œ ì—…ë°ì´íŠ¸
            inputText = e.target.value;
            updateDisplay();
        }

        function handleTypingInput(e) {
            if (!isPlaying) return;
            inputText = e.target.value;
            
            // ìë™ ì™„ë£Œ ë¡œì§ì„ ì œê±°í•˜ê³ , ì…ë ¥ ì¤‘ì—ëŠ” ì˜¤ì§ ë””ìŠ¤í”Œë ˆì´ë§Œ ì—…ë°ì´íŠ¸
            updateDisplay();
        }
        
        // ì—”í„°í‚¤ ì²˜ë¦¬ í•¨ìˆ˜ (í•µì‹¬ ìˆ˜ì •)
        function handleKeyUp(e) {
            const inputEl = e.target;
            // ì—”í„°í‚¤ (keyCode 13 ë˜ëŠ” key 'Enter')ê°€ ëˆŒë ¸ì„ ë•Œë§Œ ì²˜ë¦¬
            if (isPlaying && (e.keyCode === 13 || e.key === 'Enter')) {
                // IME ì…ë ¥ì´ ì™„ì „íˆ ëë‚¬ìŒì„ ë³´ì¥í•˜ê¸° ìœ„í•´ 1ms ì§€ì—° í›„ ê²€ì‚¬
                 setTimeout(() => {
                    checkCompletion(inputEl); 
                 }, 1);
                
                // ê¸°ë³¸ ì—”í„° ë™ì‘ ë°©ì§€
                e.preventDefault(); 
            }
        }
        
        // ì™„ë£Œ ì—¬ë¶€ë¥¼ ê²€ì‚¬í•˜ê³  ë‹¤ìŒ ë¬¸ì¥ìœ¼ë¡œ ë„˜ì–´ê°€ëŠ” ê³µí†µ í•¨ìˆ˜
        function checkCompletion(inputEl) {
            inputText = inputEl.value; 
            
            // ì—”í„°í‚¤ë¥¼ ëˆŒë €ì„ ë•Œë§Œ ì¼ì¹˜ ì—¬ë¶€ë¥¼ ê²€ì‚¬
            if (inputText.trim() === targetText.trim()) {
                changeSentenceState();
            } else {
                // ì¼ì¹˜í•˜ì§€ ì•Šìœ¼ë©´ ì˜¤íƒ€ê°€ ìˆìœ¼ë¯€ë¡œ, ì—ëŸ¬ ë©”ì‹œì§€ ì—†ì´ ë””ìŠ¤í”Œë ˆì´ë§Œ ì—…ë°ì´íŠ¸
                updateDisplay(); 
            }
        }

        loadHighScore();
    </script>
</body>
</html>